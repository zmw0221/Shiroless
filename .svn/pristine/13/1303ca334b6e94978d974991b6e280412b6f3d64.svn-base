package cn.et.test.service.impl;

import java.util.ArrayList;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import cn.et.test.dao.BibiMapper;
import cn.et.test.dao.CookMapper;
import cn.et.test.dao.CookingMapper;
import cn.et.test.entity.Bibi;
import cn.et.test.entity.BibiExample;
import cn.et.test.entity.TreeNode;
import cn.et.test.entity.cook.Cook;
import cn.et.test.entity.cook.CookExample;
import cn.et.test.entity.cooking.Cooking;
import cn.et.test.entity.cooking.CookingExample;
import cn.et.test.service.TreeNodeService;

@Service
public class TreeNodeServiceImpl implements TreeNodeService{
	
	@Autowired
	CookingMapper cm;
	@Autowired
	CookMapper ck;
	@Autowired
	BibiMapper bm;
	
	public List<TreeNode> queryTreeNode(Integer id){
		List<TreeNode> deptlist= new ArrayList<TreeNode>();
		
		BibiExample be= new BibiExample();
		be.createCriteria().andLidEqualTo(id);
		List<Bibi> bi=bm.selectByExample(be);
		for(Bibi b:bi){
			TreeNode td= new TreeNode();
			td.setId(b.getBid());
			td.setText(b.getBname());
			if(queryTreeNode(b.getBid()).size()==0){
				td.setState("open");
			}
			deptlist.add(td);
		}
		
		//å‘èµ·sqlè¯­å¥æŸ¥è¯¢æ€»è®°å½•æ•°
		CookingExample ce = new CookingExample();
		ce.createCriteria().andKidEqualTo(id);
		List<Cooking> ck= cm.selectByExample(ce);
		
		for(Cooking c:ck){
			TreeNode tn= new TreeNode();
			tn.setId(c.getCid());
			tn.setText(c.getCname());
			
			//åˆ¤æ–­å½“å‰èŠ‚ç‚¹æ˜¯å¦è¿˜å­˜åœ¨å­èŠ‚ç‚¹
			if(queryTreeNode(c.getCid()).size()==0){
				tn.setState("open");
			}
			deptlist.add(tn);
		}
		return deptlist;
	}
	//æ ¹æ®ä¼ å…¥çš„IDæŸ¥è¯¢
	public List<Cook> queryCook(Integer id,Integer page,Integer rows){
		CookExample ee= new CookExample();
		//å¦‚æœä¼ å…¥IDä¸ä¸ºç©ºå°±æ·»åŠ æ¡ä»¶cid=idã€‚æ²¡æœ‰å°±æŸ¥æ‰€æœ?
		if(id!=null)
			ee.createCriteria().andCidEqualTo(id);
		return ck.selectByExample(ee);
	}
	
	public void deleteCook(Integer fid){
		ck.deleteByPrimaryKey(fid);
	}
}
